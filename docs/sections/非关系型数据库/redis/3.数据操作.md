# 数据操作

在Redis中，键值对是基本的数据存储单元，每条数据都是⼀个键值对

## 一、键值对

### 1. 键

键的类型是字符串，键不能重复

键命令是Redis中用于对键进行操作的命令，包括：

- DEL：用于删除一个或多个键。
- EXISTS：用于检查键是否存在。
- KEYS：用于获取匹配指定模式的所有键。
- TTL：用于获取指定键的过期时间（单位为秒）。
- PERSIST：用于移除指定键的过期时间，使其永久有效。
- RENAME：用于重命名指定键名。
- TYPE：用于获取指定键所存储的值的数据类型。

例如，以下命令可以删除键名为"mykey"和"anotherkey"的两个键：

```sql
DEL mykey anotherkey
```

执行该命令后，Redis会将这两个键及其对应的值从数据库中删除。

另外，以下命令可以获取键名以"my*"开头的所有键：

```sql
KEYS my*
```

执行该命令后，Redis会返回所有键名以"my"开头的键的列表。

需要注意的是，某些键命令可能会影响Redis的性能，特别是当你的数据库中包含大量的键时。因此，在使用键命令时，应该谨慎使用，并确保在必要时使用相应的限制或优化技术。

### 2. 值

Redis中的值有五种基本类型：

1. 字符串（String）：字符串是Redis中最简单的数据结构，用于存储一个字符串值，支持的操作包括设置、获取、修改和删除等。
2. 列表（List）：列表是一个有序的字符串集合，支持在列表的头部和尾部插入和删除元素，以及获取、修改和删除指定位置的元素等操作。
3. 集合（Set）：集合是一个无序的字符串集合，支持添加、删除、判断元素是否存在等操作，还支持计算交集、并集、差集等操作。
4. 哈希（Hash）：哈希是一个键值对集合，可以看做一个小的数据库，支持增加、删除、修改、查找指定键对应的值等操作。
5. 有序集合（Sorted Set）：有序集合是一个有序的字符串集合，每个字符串都关联着一个分数，支持添加、删除、查找指定分数范围内的元素等操作。

此外，Redis还提供了一些高级数据结构，例如位图、地理位置等，以满足特定场景的需求。每种类型的值都有其特定的操作和使用场景，开发者可以根据需要选择合适的数据结构来存储和处理数据。

## 二、字符串 (string)

字符串操作是Redis中最基础和最常用的操作之一，它的灵活性和高效性使得Redis在缓存和持久化存储等场景下都得到了广泛的应用。

下面是一些常见的字符串操作及其示例：

### 1. SET key value

SET命令用于将一个键值对存储到Redis中。其中，第一个参数为键，第二个参数为值。

例如，以下命令可以将一个键名为"name"，值为"John"的键值对存储到Redis中：

```sql
SET name "John"
```

执行该命令后，Redis会将"name"作为键，"John"作为相应的值存储起来。

SET命令还支持一些可选参数，包括：

- EX seconds：为键设置过期时间（单位为秒）。
- PX milliseconds：为键设置过期时间（单位为毫秒）。
- NX：仅在键不存在时才进行设置。
- XX：仅在键已存在时才进行设置。

例如，以下命令可以将一个键名为"age"，值为30，并且过期时间为10秒的键值对存储到Redis中：

```sql
SET age 30 EX 10
```

执行该命令后，Redis会将"age"作为键，30作为相应的值存储起来，并设置其过期时间为10秒。

需要注意的是，如果键已经存在，使用SET命令会覆盖原有的值。如果你想要保留原有的值，可以使用其他命令，例如APPEND、GETSET等。

### 2. MSET

MSET命令用于设置多个键值对，其中每个键值对都由一个键和一个值组成。MSET命令的参数必须成对出现，第一个参数为键，第二个参数为对应的值。

例如，以下命令可以同时设置三个键值对：

```sql
MSET key1 "value1" key2 "value2" key3 "value3"
```

执行该命令后，Redis会将三个键值对同时设置到数据库中。

需要注意的是，如果任意一个键已经存在，那么MSET命令将覆盖该键原有的值。如果你只想设置不存在的键，可以使用MSETNX命令，它只会设置不存在的键。

另外，如果你想要获取多个键对应的值，可以使用MGET命令。MGET命令的参数为一个或多个键名，返回对应的值的列表。

### 3. GET key

GET命令用于获取存储在Redis中的键对应的值。其中，第一个参数为键名。

例如，以下命令可以获取键名为"name"的键对应的值：

```sql
GET name
```

执行该命令后，Redis会返回"name"对应的值。

需要注意的是，如果键不存在，则GET命令会返回nil。如果你想要检查一个键是否存在，可以使用EXISTS命令。

另外，GET命令只能获取存储在Redis中的简单值类型，例如字符串、数字等。如果你想要获取其他类型的值，例如列表、集合、哈希等，请使用相应的命令，例如LRANGE、SMEMBERS、HGET等。

### 4. MGET

MGET命令用于获取多个键对应的值，其中，命令的参数为一个或多个键名。

例如，以下命令可以获取键名为"key1"和"key2"的键所对应的值：

```sql
MGET key1 key2
```

执行该命令后，Redis会返回一个包含"key1"和"key2"所对应的值的列表。

需要注意的是，如果某个键不存在，MGET命令将在结果列表中使用nil表示。如果你只想获取存在的键所对应的值，可以使用EXISTS命令先检查键是否存在。

另外，如果你想同时设置多个键值对，可以使用MSET命令。MSET命令的参数必须成对出现，第一个参数为键，第二个参数为对应的值。

### 3. INCR key

```sql
SET count 10
INCR count
```

INCR命令用于将存储在Redis键中的值递增1。在使用INCR命令时，应该指定要递增值的键名作为命令的第一个参数。如果键不存在，则会将其初始值设置为0，然后将其递增1。

!>INCR命令只能递减整数类型的值。如果键中存储的不是整数类型的值，则会出现类型错误的错误。

### 4. DECR key

```sql
SET count 10
DECR count
```

DECR命令用于将存储在Redis键中的值递减1。在使用DECR命令时，应该指定要递减值的键名作为命令的第一个参数。如果键不存在，则会将其初始值设置为0，然后将其递减1。

!>DECR命令只能递减整数类型的值。如果键中存储的不是整数类型的值，则会出现类型错误的错误。

### 5. APPEND key value

APPEND命令用于将指定的字符串追加到已有字符串的末尾。如果键不存在，APPEND命令将创建一个新的键，并将指定字符串作为其值。其中，第一个参数为键名，第二个参数为要追加的字符串。

例如，以下命令可以将字符串"World"追加到键名为"name"的字符串末尾：

```sql
APPEND name "World"
```

执行该命令后，Redis会将字符串"World"追加到键"name"的值的末尾。

### 6. STRLEN key

STRLEN命令用于获取键所对应的字符串的长度。其中，第一个参数为键名。

例如，以下命令可以获取键名为"name"的字符串的长度：

```sql
STRLEN name
```

执行该命令后，Redis会返回键"name"所对应的字符串的长度。

需要注意的是，如果键不存在，STRLEN命令将返回0，而如果键的值不是字符串类型，STRLEN命令将返回错误。另外，如果你想要获取其他类型的值的长度，例如列表、哈希等，可以使用相应的命令，例如LLEN、HLEN等。

### 7. GETRANGE key start end

GETRANGE命令用于获取指定字符串的子字符串。其中，第一个参数为键名，第二个参数为子字符串的起始下标，第三个参数为子字符串的结束下标。

例如，以下命令可以获取键名为"greeting"的字符串中下标为0至4的子字符串：

```sql
GETRANGE greeting 0 4
```

执行该命令后，Redis会返回键"greeting"的值的子字符串"Hello"。

需要注意的是，GETRANGE命令返回的范围是左闭右闭的，也就是说，返回的结果中包含起始下标和结束下标所对应的字符。如果你想要获取字符串的最后几个字符，可以将起始下标设置为一个负数，表示从字符串末尾开始的偏移量。

另外，如果你想要获取整个字符串，可以将起始下标设置为0，将结束下标设置为-1。

## 三、列表 (list)

列表（List）是Redis中一种有序的字符串集合，每个字符串称为一个元素。Redis中的列表是一个双向链表结构，它支持在列表的两端进行插入和删除操作，同时还支持根据下标获取元素、设置元素等操作。以下是一些常见的列表操作：

### 1. LPUSH

LPUSH命令用于在列表的头部插入一个或多个元素。其中，第一个参数为列表的键名，后面的参数为要插入的元素。

例如，以下命令可以在列表名为"mylist"的列表头部插入三个元素：

```sql
LPUSH mylist "element1" "element2" "element3"
```

### 2. RPUSH

RPUSH命令用于在列表的尾部插入一个或多个元素。其中，第一个参数为列表的键名，后面的参数为要插入的元素。

例如，以下命令可以在列表名为"mylist"的列表尾部插入三个元素：

```sql
RPUSH mylist "element1" "element2" "element3"
```

### 3. LPOP

LPOP命令用于删除并返回列表的头部元素。其中，第一个参数为列表的键名。

例如，以下命令可以删除列表名为"mylist"的列表头部元素并返回其值：

```sql
LPOP mylist
```

### 4. RPOP

RPOP命令用于删除并返回列表的尾部元素。其中，第一个参数为列表的键名。

例如，以下命令可以删除列表名为"mylist"的列表尾部元素并返回其值：

```sql
RPOP mylist
```

### 5. LINDEX

LINDEX命令用于获取列表中指定下标的元素。其中，第一个参数为列表的键名，第二个参数为要获取的元素的下标。

例如，以下命令可以获取列表名为"mylist"的列表中下标为2的元素：

```sql
LINDEX mylist 2
```

### 6. LLEN

LLEN命令用于获取列表的长度（即列表中元素的数量）。其中，第一个参数为列表的键名。

例如，以下命令可以获取列表名为"mylist"的列表的长度：

```sql
LLEN mylist
```

### 7. LRANGE

获取列表中的部分元素可以使用LRANGE命令，该命令用于获取列表中指定范围内的元素，其中第一个参数为列表的键名，第二个参数为起始下标，第三个参数为结束下标。

例如，以下命令可以获取列表名为"mylist"中下标从0到2的元素：

```sql
LRANGE mylist 0 2
```

执行该命令后，Redis会返回列表"mylist"中下标为0、1、2的元素。

需要注意的是，LRANGE命令的下标从0开始，如果结束下标为-1，则表示获取从起始下标到列表末尾的所有元素。另外，当列表中的元素数量较多时，一次性获取所有元素可能会对Redis的性能产生影响，因此，在实际应用中，应该考虑分批次获取元素或者使用其他更适合的数据结构。

以上是一些常用的列表操作，需要注意的是，列表操作是基于Redis的内存数据库，所以在对列表进行操作时，需要注意数据的大小和内存使用情况，以免出现内存不足或者性能问题。

## 四、集合 (set)

集合（Set）是Redis中一种无序的字符串集合，其中每个字符串都称为一个元素。集合的基本操作包括添加元素、删除元素、判断元素是否存在、计算集合的交集、并集和差集等。以下是一些常见的集合操作：

### 1. SADD

SADD命令用于向集合中添加一个或多个元素。其中，第一个参数为集合的键名，后面的参数为要添加到集合中的元素。

例如，以下命令可以向集合名为"myset"的集合中添加三个元素：

```sql
SADD myset "element1" "element2" "element3"
```

### 2. SREM

SREM命令用于从集合中删除一个或多个元素。其中，第一个参数为集合的键名，后面的参数为要从集合中删除的元素。

例如，以下命令可以从集合名为"myset"的集合中删除两个元素：

```sql
SREM myset "element1" "element2"
```

### 3. SISMEMBER

SISMEMBER命令用于判断指定元素是否存在于集合中。其中，第一个参数为集合的键名，第二个参数为要判断的元素。

例如，以下命令可以判断元素"element1"是否存在于集合名为"myset"的集合中：

```sql
SISMEMBER myset "element1"
```

如果元素"element1"存在于集合中，则该命令会返回1；否则返回0。

### 4. SMEMBERS

SMEMBERS命令用于获取集合中所有的元素。其中，第一个参数为集合的键名。

例如，以下命令可以获取集合名为"myset"的集合中的所有元素：

```sql
SMEMBERS myset
```

### 5. SINTER

SINTER命令用于获取多个集合的交集。其中，第一个参数为第一个集合的键名，后面的参数为要求交集的集合的键名。

例如，以下命令可以获取集合名为"set1"和"set2"的两个集合的交集：

```sql
SINTER set1 set2
```

### 6. SUNION

SUNION命令用于获取多个集合的并集。其中，第一个参数为第一个集合的键名，后面的参数为要求并集的集合的键名。

例如，以下命令可以获取集合名为"set1"和"set2"的两个集合的并集：

```sql
SUNION set1 set2
```

### 7. SDIFF

SDIFF命令用于获取多个集合的差集。其中，第一个参数为第一个集合的键名，后面的参数为要求差集的集合的键名。

例如，以下命令可以获取集合名为"set1"和"set2"的两个集合的差集：

```sql
SDIFF set1 set2
```

需要注意的是，Redis中的集合是无序的，每个元素都是唯一的，而且集合中元素的数量是有限的，当集合中的元素数量较多时，可能会对性能产生影响，因此，在实际应用中，应该根据实际情况选择合适的数据结构来存储和处理数据。

## 五、有序集合 (sorted set)

有序集合（Sorted Set）是Redis中一种有序的字符串集合，其中每个字符串都关联着一个分数，可以看作是一个“分数-字符串”映射表。有序集合中的元素按照分数从小到大排序，支持添加、删除、修改、获取指定范围内元素等操作。以下是一些常见的有序集合操作：

### 1. ZADD

ZADD命令用于向有序集合中添加一个或多个元素。其中，第一个参数为有序集合的键名，后面的参数为要添加的元素，每个元素由两部分组成，分别是元素的分数和元素的值。

例如，以下命令可以向有序集合名为"myzset"的有序集合中添加三个元素：

```sql
ZADD myzset 1 "element1" 2 "element2" 3 "element3"
```

### 2. ZREM

ZREM命令用于从有序集合中删除一个或多个元素。其中，第一个参数为有序集合的键名，后面的参数为要删除的元素。

例如，以下命令可以从有序集合名为"myzset"的有序集合中删除两个元素：

```sql
ZREM myzset "element1" "element2"
```

### 3. ZSCORE

ZSCORE命令用于获取有序集合中指定元素的分数。其中，第一个参数为有序集合的键名，第二个参数为要获取分数的元素。

例如，以下命令可以获取有序集合名为"myzset"中元素"element1"的分数：

```sql
ZSCORE myzset "element1"
```

### 4. ZRANGE

ZRANGE命令用于获取有序集合中指定范围内的元素。其中，第一个参数为有序集合的键名，第二个参数为起始下标，第三个参数为结束下标，第四个参数为是否返回元素的分数。

例如，以下命令可以获取有序集合名为"myzset"中分数在1到3之间的元素及其分数：

```sql
ZRANGE myzset 1 3 WITHSCORES
```

### 5. ZREVRANGE

ZREVRANGE命令用于获取有序集合中指定范围内的元素，并按照分数从大到小排序。其中，第一个参数为有序集合的键名，第二个参数为起始下标，第三个参数为结束下标，第四个参数为是否返回元素的分数。

例如，以下命令可以获取有序集合名为"myzset"中分数在3到1之间的元素及其分数：

```sql
ZREVRANGE myzset 1 3 WITHSCORES
```

### 6. ZINCRBY

ZINCRBY命令用于将有序集合中指定元素的分数加上一个给定的增量。其中，第一个参数为有序集合的键名，第二个参数为要增加分数的元素，第三个参数为要增加的分数。

例如，以下命令可以将有序集合名为"myzset"中元素"element1"的分数增加5：

```sql
ZINCRBY myzset 5 "element1"
```

### 7. ZCARD

ZCARD命令用于获取有序集合中元素的数量。其中，第一个参数为有序集合的键名。

例如，以下命令可以获取有序集合名为"myzset"中元素的数量：

```sql
ZCARD myzset
```

以上是一些常用的有序集合操作，需要注意的是，有序集合中的元素是按照分数从小到大排序的，如果多个元素的分数相同，则按照字典序进行排序。有序集合的实现方式一般使用跳跃表（Skip List），它可以在插入、删除、查找等操作上保证高效性和可扩展性。

## 六、哈希 (hash)

哈希（hash）是Redis中一种用于存储对象的数据结构。哈希中的每个键都可以对应多个键值对，因此可以用来表示一个对象，例如一个用户、一篇文章、一条订单等等。下面是一些哈希操作的示例：

### 1. HSET

HSET命令用于设置哈希对象中的一个键值对。其中，第一个参数为哈希对象的键名，第二个参数为键，第三个参数为对应的值。

例如，以下命令可以将一个哈希对象名为"user:1000"中的键名为"name"的键值对设置为"John"：

```sql
HSET user:1000 name "John"
```

### 2. HGET

HGET命令用于获取哈希对象中指定键的值。其中，第一个参数为哈希对象的键名，第二个参数为要获取的键名。

例如，以下命令可以获取哈希对象名为"user:1000"中键名为"name"的键对应的值：

```sql
HGET user:1000 name
```

### 3. HGETALL

HGETALL命令用于获取哈希对象中所有键值对。其中，第一个参数为哈希对象的键名。

例如，以下命令可以获取哈希对象名为"user:1000"中所有键值对：

```sql
HGETALL user:1000
```

### 4. HMSET

HMSET命令用于设置哈希对象中多个键值对。其中，第一个参数为哈希对象的键名，后面的参数为一系列的键值对，每对键值对都由一个键和一个值组成。

例如，以下命令可以同时设置哈希对象名为"user:1000"中的两个键值对：

```sql
HMSET user:1000 name "John" age 30
```

### 5. HMGET

HMGET命令用于获取哈希对象中多个键对应的值。其中，第一个参数为哈希对象的键名，后面的参数为要获取值的一系列键名。

例如，以下命令可以获取哈希对象名为"user:1000"中键名为"name"和"age"的键所对应的值：

```sql
HMGET user:1000 name age
```

### 6. HDEL

HDEL命令用于删除哈希对象中一个或多个键。其中，第一个参数为哈希对象的键名，后面的参数为要删除的一系列键名。

例如，以下命令可以删除哈希对象名为"user:1000"中键名为"name"和"age"的两个键：

```sql
HDEL user:1000 name age
```

需要注意的是，上述示例中的键名和值都可以是字符串类型。另外，哈希对象可以嵌套，即一个哈希对象中的键值对的值也可以是一个哈希对象。在处理嵌套哈希对象时，可以使用上述的哈希操作命令进行操作。
