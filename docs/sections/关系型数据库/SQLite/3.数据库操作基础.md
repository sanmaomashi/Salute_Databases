# 数据库操作

## 一、基础基础

### 1.  显示数据库

要在SQLite中显示已有的数据库，可以使用以下命令：

```bash
sqlite3 .databases
```

这个命令将列出SQLite中所有可用的数据库，包括在内存中的数据库和从磁盘加载的数据库。在输出中，每个数据库都有一个编号，可以使用这个编号选择要使用的数据库。例如：

```bash
seq  name             file
---  ---------------  ----------------------------------------------------------
0    main
2    temp
```

在这个输出中，我们可以看到两个可用的数据库，分别用编号0和2表示。默认情况下，SQLite使用编号0表示当前连接的数据库，这通常是从文件加载的数据库。

### 2. 创建数据库

要创建一个新的SQLite数据库，您可以使用以下命令：

```bash
sqlite3 new_database.db
```

将`new_database.db`替换为实际的数据库文件名。执行此命令后，如果指定的数据库文件不存在，SQLite将创建一个新的数据库文件。如果文件已经存在，SQLite将打开现有的数据库。

### 3. 打开和关闭数据库

要打开一个现有的SQLite数据库，您可以使用以下命令：

```bash
sqlite3 existing_database.db
```

将`existing_database.db`替换为实际的数据库文件名。执行此命令后，SQLite将打开现有的数据库，并进入命令行界面。

在SQLite命令行界面中，要打开另一个数据库，可以使用以下命令：

```bash
.open another_database.db
```

将`another_database.db`替换为实际的数据库文件名。执行此命令后，SQLite将关闭当前打开的数据库，并打开指定的数据库。

要关闭一个已打开的数据库，可以直接退出SQLite命令行界面，使用以下命令：

```bash
.quit
```

### 4. 删除数据库

要删除一个SQLite数据库，您只需删除相应的数据库文件即可。在命令行或终端中，根据操作系统的不同，使用以下命令删除数据库文件：

- Windows

  ```bash
  del database_name.db
  ```

- macOS和Linux

  ```bash
  rm database_name.db
  ```

将`database_name.db`替换为实际的数据库文件名。请注意，此操作将永久删除数据库文件及其包含的所有数据，请谨慎执行。

## 二、数据定义语言（DDL）

数据定义语言（DDL）是SQL的一个子集，用于定义和管理数据库结构，包括创建、修改和删除表等。在本章中，我们将介绍如何使用SQLite进行DDL操作。

### 1. 创建表

要在SQLite中创建一个新表，可以使用CREATE TABLE语句。以下是一个创建表的示例：

```sql
CREATE TABLE employees (
    id INTEGER PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT UNIQUE,
    hire_date DATE NOT NULL
);
```

在这个示例中，我们创建了一个名为“employees”的表，包含五个字段：id、first_name、last_name、email和hire_date。每个字段都有一个数据类型，如INTEGER、TEXT和DATE。此外，我们还为某些字段设置了约束，如PRIMARY KEY、NOT NULL和UNIQUE。

### 2. 修改表

要修改SQLite中的现有表，可以使用ALTER TABLE语句。以下是一些常见的修改表操作：

- 重命名表

  要重命名一个表，可以使用以下语句：

  ```sql
  ALTER TABLE old_table_name RENAME TO new_table_name;
  ```

  将`old_table_name`替换为原表名，将`new_table_name`替换为新表名。

- 添加列

  要向现有表中添加新列，可以使用以下语句：

  ```sql
  ALTER TABLE table_name ADD COLUMN column_name data_type [constraints];
  ```

  将`table_name`替换为表名，将`column_name`替换为新列名，将`data_type`替换为新列的数据类型，将`constraints`替换为适用于新列的约束（如NOT NULL、DEFAULT等）。

  例如，要向“employees”表中添加一个名为“department_id”的新列，可以使用以下语句：

  ```sql
  ALTER TABLE employees ADD COLUMN department_id INTEGER;
  ```

请注意，SQLite的ALTER TABLE语句有一些限制。例如，您无法删除列、修改列类型或添加多个列。要进行这些操作，您需要使用其他方法，如创建临时表、将数据复制到临时表、重新创建原表并将数据复制回原表。

### 3. 删除表

要删除SQLite中的现有表，可以使用DROP TABLE语句。以下是一个删除表的示例：

```sql
DROP TABLE table_name;
```

将`table_name`替换为要删除的表名。请注意，此操作将永久删除表及其包含的所有数据，请谨慎执行。



## 三、数据操作语言（DML）

数据操作语言（DML）是SQL的一个子集，用于操作和管理数据库中的数据，包括插入、更新、删除和查询等。在本章中，我们将介绍如何使用SQLite进行DML操作。

### 1. 插入数据

要在SQLite中向表中插入数据，可以使用INSERT语句。以下是一个插入数据的示例：

```sql
INSERT INTO employees (id, first_name, last_name, email, hire_date)
VALUES (1, 'John', 'Doe', 'john.doe@example.com', '2022-01-01');
```

在这个示例中，我们向“employees”表中插入了一条新记录，包含五个字段：id、first_name、last_name、email和hire_date。可以使用VALUES子句为每个字段提供相应的值。

### 2. 更新数据

要在SQLite中更新表中的现有数据，可以使用UPDATE语句。以下是一个更新数据的示例：

```sql
UPDATE employees
SET email = 'johndoe@example.com', hire_date = '2022-01-02'
WHERE id = 1;
```

在这个示例中，我们更新了“employees”表中id为1的记录，将email字段的值更改为'[johndoe@example.com](mailto:johndoe@example.com)'，将hire_date字段的值更改为'2022-01-02'。

### 3.删除数据

要在SQLite中删除表中的数据，可以使用DELETE语句。以下是一个删除数据的示例：

```sql
DELETE FROM employees
WHERE id = 1;
```

在这个示例中，我们删除了“employees”表中id为1的记录。请注意，此操作将永久删除指定的数据，请谨慎执行。

### 4. 查询数据

要在SQLite中查询表中的数据，可以使用SELECT语句。以下是一些查询数据的示例：

- 查询所有记录和字段：

  ```sql
  SELECT * FROM employees;
  ```

- 查询特定字段：

  ```sql
  SELECT first_name, last_name, email FROM employees;
  ```

- 使用条件过滤查询结果：

  ```sql
  SELECT * FROM employees
  WHERE hire_date >= '2022-01-01';
  ```

- 对查询结果进行排序：

  ```sql
  SELECT * FROM employees
  ORDER BY last_name, first_name;
  ```

- 对查询结果进行分页：

  ```sql
  SELECT * FROM employees
  LIMIT 10 OFFSET 20;
  ```

在这些示例中，我们查询了“employees”表中的数据，使用不同的选项和条件进行筛选、排序和分页。

## 四、高级查询

### 1. 连接表

要在SQLite中查询多个表的数据，可以使用连接（JOIN）操作。以下是一些常见的连接操作示例：

- 内连接（INNER JOIN）：

  ```sql
  SELECT employees.id, employees.first_name, employees.last_name, departments.name
  FROM employees
  INNER JOIN departments ON employees.department_id = departments.id;
  ```

  在这个示例中，我们查询了“employees”和“departments”表中的数据，通过department_id字段将这两个表连接起来。

- 左连接（LEFT JOIN）：

  ```sql
  SELECT employees.id, employees.first_name, employees.last_name, departments.name
  FROM employees
  LEFT JOIN departments ON employees.department_id = departments.id;
  ```

  在这个示例中，我们使用左连接查询了“employees”和“departments”表中的数据，即使某些员工没有对应的部门，也会返回员工记录。

### 2. 分组和聚合

要在SQLite中对查询结果进行分组和聚合，可以使用GROUP BY和聚合函数。以下是一个分组和聚合的示例：

```sql
SELECT departments.name, COUNT(employees.id) as employee_count
FROM employees
INNER JOIN departments ON employees.department_id = departments.id
GROUP BY departments.name;
```

在这个示例中，我们查询了“employees”和“departments”表中的数据，并按部门名称进行分组。然后，我们使用COUNT函数计算每个部门的员工数量。

### 3. 子查询

要在SQLite中使用子查询，可以在主查询的FROM、WHERE或SELECT子句中嵌套另一个查询。以下是一些子查询的示例：

- 子查询作为表：

  ```sql
  SELECT id, first_name, last_name
  FROM (
      SELECT * FROM employees
      WHERE hire_date >= '2022-01-01'
  ) AS recent_employees;
  ```

  在这个示例中，我们首先查询了雇佣日期在2022-01-01之后的员工记录，然后从这些记录中选择id、first_name和last_name字段。

- 子查询作为条件：

  ```sql
  SELECT * FROM employees
  WHERE department_id IN (
      SELECT id FROM departments
      WHERE name LIKE '%Engineering%'
  );
  ```

  在这个示例中，我们首先查询了名称包含“Engineering”的部门记录，然后从这些部门中选择员工记录。

- 子查询作为字段：

  ```sql
  SELECT first_name, last_name,
      (SELECT name FROM departments WHERE id = employees.department_id) AS department_name
  FROM employees;
  ```

  在这个示例中，我们查询了“employees”表中的数据，并使用子查询为每个员工查找对应的部门名称。
